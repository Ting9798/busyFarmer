<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小農商城-小農好忙</title>
    <link rel="icon" href="./favicon.ico">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel" src="https://ting9798.github.io/busyFarmer/js/Navbar.js"></script>
    <script type="text/babel" src="https://ting9798.github.io/busyFarmer/js/useAdjustMargin.js"></script>
    <script type="text/babel" src="https://ting9798.github.io/busyFarmer/js/Breadcrumbs.js"></script>
    <script type="text/babel" src="https://ting9798.github.io/busyFarmer/js/ButtonGroup.js"></script>
    <script type="text/babel" src="https://ting9798.github.io/busyFarmer/js/Footer.js"></script>

    <link rel="stylesheet" href="./css/style.min.css">
</head>

<body>


    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const AddressSelect = ({ value, onChange }) => (
            <select value={value} onChange={onChange} className="form-select">
                <option value="" disabled>縣市</option>
                <optgroup label="北部">
                    <option value="臺北市">臺北市</option>
                    <option value="新北市">新北市</option>
                    <option value="基隆市">基隆市</option>
                    <option value="宜蘭縣">宜蘭縣</option>
                    <option value="桃園市">桃園市</option>
                    <option value="新竹縣">新竹縣</option>
                    <option value="新竹市">新竹市</option>
                </optgroup>
                <optgroup label="中部">
                    <option value="苗栗縣">苗栗縣</option>
                    <option value="臺中市">臺中市</option>
                    <option value="彰化縣">彰化縣</option>
                    <option value="南投縣">南投縣</option>
                    <option value="雲林縣">雲林縣</option>
                </optgroup>
                <optgroup label="南部">
                    <option value="嘉義縣">嘉義縣</option>
                    <option value="嘉義市">嘉義市</option>
                    <option value="台南市">台南市</option>
                    <option value="高雄市">高雄市</option>
                    <option value="屏東縣">屏東縣</option>
                </optgroup>
                <optgroup label="東部">
                    <option value="花蓮縣">花蓮縣</option>
                    <option value="台東縣">台東縣</option>
                </optgroup>
                <optgroup label="離島">
                    <option value="澎湖縣">澎湖縣</option>
                    <option value="金門縣">金門縣</option>
                    <option value="連江縣">連江縣</option>
                </optgroup>
            </select>
        );
        const App = React.forwardRef((props, ref) => {

            const [navProps, setNavProps] = useState({
                headerclassName: 'greenTopbar',
                logoImg: './images/shared/logo-02.svg',
                textColor: 'green'
            });

            useAdjustMargin(navProps.headerclassName);

            const paths = [
                { name: '首頁', href: './index.html' },
                { name: '購物車', href: './cart.html' }
            ];

            const [cart, setCart] = useState([]);

            // 讀取本地存儲中的購物車資料
            useEffect(() => {
                const storedCart = JSON.parse(localStorage.getItem('cart')) || [];
                setCart(storedCart);
            }, []);

            // 更新購物車的函數，並同步更新本地存儲
            useEffect(() => {
                localStorage.setItem('cart', JSON.stringify(cart));
            }, [cart]);

            const [isTableVisible, setIsTableVisible] = useState(true);
            const [isButtonRotated, setIsButtonRotated] = useState(false);
            const handleToggleTable = () => {
                setIsTableVisible(prevState => !prevState);
                setIsButtonRotated(prevState => !prevState);
            };

            // 商品總價
            const totalPrice = cart.reduce((total, item) => {
                // 檢查discountPrice是否存在 不存在就用price
                const priceToUse = item.discountPrice || item.price;
                return total + priceToUse * item.quantity;
            }, 0);

            // 運費
            const shippingCost = totalPrice >= 1000 ? 0 : 50;

            // 運費+商品總價
            const grandTotal = totalPrice + shippingCost;

            // 表單功能
            const [formData, setFormData] = useState({
                orderGender: '',
                orderName: '',
                orderEmail: '',
                orderMobile: '',
                orderPhone: '',
                orderAddress: '',
                postalCode: '',
                addressDetail: '',
                recipientGender: '',
                recipientName: '',
                recipientEmail: '',
                recipientMobile: '',
                recipientPhone: '',
                recipientAddress: '',
                recipientPostalCode: '',
                recipientAddressDetail: '',
                recipientCity: ''
            });
            const [isSameOrder, setIsSameOrder] = useState('');
            const [invoiceType, setInvoiceType] = useState('');
            const [companyName, setCompanyName] = useState('');
            const [taxId, setTaxId] = useState('');
            const [mobileBarcode, setMobileBarcode] = useState('');
            const [consent, setConsent] = useState(false);

            const handleInputChange = (e) => {
                const { name, value, type, checked } = e.target;

                if (type === 'checkbox') {
                    setFormData(prev => ({ ...prev, [name]: checked }));
                } else if (type === 'radio') {
                    setFormData(prev => ({ ...prev, [name]: value }));
                } else {
                    setFormData(prev => ({ ...prev, [name]: value }));
                }
            };

            const handleCheckboxChange = (e) => {
                setIsSameOrder(e.target.checked);
            };

            const handleConsentChange = (e) => {
                setConsent(e.target.checked);
            };

            // 設置狀態來跟蹤選擇的配送方式
            const [selectedOption, setSelectedOption] = useState(null);

            const handleSelect = (option) => {
                setSelectedOption(option);
            };

            const [paymentOption, setPaymentOption] = useState(null);
            const handlePayment = (option) => {
                setPaymentOption(option);
            };

            return (
                <>
                    {/* 導覽列*/}
                    <Nav
                        headerClassName={navProps.headerclassName}
                        logoImg={navProps.logoImg}
                        textColor={navProps.textColor}
                    />
                    <div id="title">
                        <Breadcrumbs paths={paths} />
                        <div className="cart-title">
                            <div className="tit-box">
                                <div className="tit-box-text">
                                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M18.7695 41.56C20.4264 41.56 21.7695 40.2169 21.7695 38.56C21.7695 36.9031 20.4264 35.56 18.7695 35.56C17.1127 35.56 15.7695 36.9031 15.7695 38.56C15.7695 40.2169 17.1127 41.56 18.7695 41.56Z"
                                            fill="#6C8C42" />
                                        <path
                                            d="M38.3398 41.56C39.9967 41.56 41.3398 40.2169 41.3398 38.56C41.3398 36.9031 39.9967 35.56 38.3398 35.56C36.683 35.56 35.3398 36.9031 35.3398 38.56C35.3398 40.2169 36.683 41.56 38.3398 41.56Z"
                                            fill="#6C8C42" />
                                        <path d="M5.91992 10.83L8.92992 9.19C9.96992 8.63 11.2599 9.06 11.7499 10.13L14.0399 15.11"
                                            stroke="#6C8C42" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                                        <path d="M17.8702 27.76L16.6602 30.75C16.1202 32.09 17.1002 33.56 18.5502 33.56H40.4302"
                                            stroke="#6C8C42" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                                        <path
                                            d="M28.1198 19.29C27.5298 19.07 26.4198 20.02 26.3398 20.93C26.3398 20.97 26.3498 21.62 26.8598 21.96C27.0898 22.12 27.4998 22.25 27.8298 22.08C27.9698 22.01 28.1298 21.86 28.2698 21.45C28.4898 20.78 28.6498 19.49 28.1298 19.3L28.1198 19.29Z"
                                            fill="#6C8C42" />
                                        <path
                                            d="M30.3408 19.39C30.7308 19.14 31.6808 19.65 31.8708 20.29C31.8708 20.32 31.9708 20.78 31.6608 21.11C31.5208 21.26 31.2508 21.42 30.9908 21.35C30.8808 21.32 30.7408 21.24 30.5808 20.96C30.3108 20.51 30.0008 19.61 30.3408 19.39Z"
                                            fill="#6C8C42" />
                                        <path
                                            d="M18.0505 18.75C18.4005 22.84 22.7205 25.61 26.4405 26.29C27.0805 26.4 26.9205 27.38 26.2805 27.28C22.2905 26.33 17.8805 23.17 17.7305 18.76C17.7305 18.55 18.0505 18.55 18.0505 18.76V18.75Z"
                                            fill="#6C8C42" />
                                        <path
                                            d="M17.0107 15.58C16.7007 15.98 16.2707 16.64 16.0107 17.56C16.0107 17.56 15.6107 18.81 15.9307 20.28C16.4407 22.63 18.7507 25.77 22.2607 27.56C28.2707 30.61 34.3207 27.89 34.6507 27.74C37.9207 26.21 42.1907 22.62 42.1007 18.32C42.1007 17.89 42.0307 15.13 40.0407 13.71C38.4007 12.55 36.3707 12.93 35.9807 13.01C32.5207 13.73 32.0707 17.18 28.6407 17.53C27.5607 17.64 26.6907 17.39 26.3407 17.29C23.5407 16.47 22.9907 14.31 21.0407 13.95C20.1907 13.79 18.8807 13.95 17.0007 15.59L17.0107 15.58Z"
                                            stroke="#6C8C42" strokeWidth="2" strokeMiterlimit="10" />
                                    </svg>
                                    <h3>購物車</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    <main>
                        {/*進度條*/}
                        <section id="progressBar-box">
                            <div className="progressBar-bg checkPage">
                                <div className="progressBar checkPage"></div>
                            </div>
                            <div className="progressBar-text-box">
                                <div className="progressBar-textbox">
                                    <div className="progressBar-text">01商品確認</div>
                                    <div className="progressBar-text checkPage">02填寫資料</div>
                                    <div className="progressBar-text">03完成購買</div>
                                </div>
                            </div>
                        </section>

                        {/*商品收合確認欄*/}
                        <section id="product-section">
                            <div className="grandTotal">本次消費總計<span>{`NT.${grandTotal}`}</span></div>
                            <button id="closeProduct" onClick={handleToggleTable}>
                                <div>{`共${cart.reduce((total, item) => total + item.quantity, 0)}項商品`}</div>
                                <div className={isButtonRotated ? 'rotate' : ''}>
                                    <svg width="7" height="6" viewBox="0 0 7 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M6 1L3.5 5L1 1" stroke="#514535" strokeLinecap="round" strokeLinejoin="round" />
                                    </svg>
                                </div>
                            </button>
                            {isTableVisible && (
                                <table className="product-table">
                                    <thead className="product-header">
                                        <tr className="product-header-box">
                                            <td className="product-header-cell"></td>
                                            <td className="product-header-cell">商品名稱</td>
                                            <td className="product-header-cell">單件價格</td>
                                            <td className="product-header-cell">數量</td>
                                            <td className="product-header-cell">小計</td>
                                            <td className="product-header-cell"></td>
                                        </tr>
                                    </thead>
                                    <tbody className="product-row">
                                        {cart.map(item => (
                                            <tr key={item.id}>
                                                <td className="product-cell">
                                                    <a href="./product.html">
                                                        <img src={item.src} alt={item.name} />
                                                    </a>
                                                </td>
                                                <td className="product-cell">
                                                    <a href="./product.html">
                                                        <div>{item.name}<br />{item.egName}</div>
                                                    </a>
                                                    {item.notes && (
                                                        <div className="item-notes">
                                                            <div>備註:<br /> {item.notes}</div>
                                                        </div>
                                                    )}
                                                </td>
                                                <td className="product-cell">
                                                    {item.discountPrice ? `NT.${item.discountPrice}` : `NT.${item.price}`}
                                                </td>
                                                <td className="product-cell">
                                                    <input type="text" className="quantity-input" value={item.quantity} readOnly />
                                                </td>
                                                <td className="product-cell">{
                                                    item.discountPrice ? `NT.${item.discountPrice * item.quantity}` : `NT.${item.price * item.quantity}`
                                                }
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </section>

                        <section id="order-form">
                            <div className="order-form-box">
                                <form>
                                    <div className="order-info">
                                        <div className="form-header">訂購人與收件人資訊填寫</div>
                                        <fieldset>
                                            <legend className="order-info-header">訂購人資訊</legend>
                                            <div className="ordering-person">
                                                <div className="gender-selection">
                                                    <div>
                                                        <label htmlFor="orderName">訂購人姓名</label>
                                                        <label>
                                                            <input
                                                                type="radio"
                                                                name="orderGender"
                                                                value="male"
                                                                checked={formData.orderGender === 'male'}
                                                                onChange={handleInputChange}
                                                                required
                                                            />
                                                            先生
                                                        </label>
                                                        <label>
                                                            <input
                                                                type="radio"
                                                                name="orderGender"
                                                                value="female"
                                                                checked={formData.orderGender === 'female'}
                                                                onChange={handleInputChange}
                                                                required
                                                            />
                                                            女士
                                                        </label>
                                                    </div>
                                                    <input
                                                        type="text"
                                                        id="orderName"
                                                        name="orderName"
                                                        className="user-input"
                                                        placeholder="姓名"
                                                        value={formData.orderName}
                                                        onChange={handleInputChange}
                                                        required
                                                    />
                                                </div>
                                                <label htmlFor="orderEmail">電子信箱</label>
                                                <input
                                                    type="email"
                                                    id="orderEmail"
                                                    name="orderEmail"
                                                    className="user-input"
                                                    placeholder="E-mail"
                                                    value={formData.orderEmail}
                                                    onChange={handleInputChange}
                                                    required
                                                />
                                                <label htmlFor="orderMobile">手機號碼</label>
                                                <input
                                                    type="tel"
                                                    id="orderMobile"
                                                    name="orderMobile"
                                                    className="user-input"
                                                    placeholder="0912345678"
                                                    value={formData.orderMobile}
                                                    onChange={handleInputChange}
                                                    required
                                                />
                                                <label htmlFor="orderPhone">室內電話</label>
                                                <input
                                                    type="tel"
                                                    id="orderPhone"
                                                    name="orderPhone"
                                                    className="user-input"
                                                    placeholder="0222123456"
                                                    value={formData.orderPhone}
                                                    onChange={handleInputChange}
                                                />
                                                <label className="recipient-address-header">訂購人地址</label>
                                                <AddressSelect
                                                    value={formData.orderAddress}
                                                    onChange={(e) => setFormData({ ...formData, orderAddress: e.target.value })}
                                                    required
                                                />
                                                <div className="address-details">
                                                    <label htmlFor="postalCode"></label>
                                                    <input
                                                        type="text"
                                                        id="postalCode"
                                                        name="postalCode"
                                                        className="postal-code"
                                                        placeholder="郵遞區號"
                                                        value={formData.postalCode}
                                                        onChange={handleInputChange}
                                                        required
                                                    />
                                                    <label htmlFor="addressDetail"></label>
                                                    <input
                                                        type="text"
                                                        id="addressDetail"
                                                        name="addressDetail"
                                                        className="address-detail"
                                                        placeholder="收件地址"
                                                        value={formData.addressDetail}
                                                        onChange={handleInputChange}
                                                        required
                                                    />
                                                </div>
                                            </div>
                                        </fieldset>

                                        <fieldset>
                                            <legend className="order-info-header">收件人資訊</legend>
                                            <div>
                                                <input
                                                    type="checkbox"
                                                    id="sameOrder"
                                                    name="sameOrder"
                                                    checked={isSameOrder}
                                                    onChange={handleCheckboxChange}
                                                />
                                                <label htmlFor="sameOrder">與訂購人相同</label>
                                            </div>
                                            {!isSameOrder && (
                                                <div className="ordering-person">
                                                    <div className="gender-selection">
                                                        <div>
                                                            <label htmlFor="recipientName">收件人姓名</label>
                                                            <label>
                                                                <input
                                                                    type="radio"
                                                                    name="recipientGender"
                                                                    value="male"
                                                                    checked={formData.recipientGender === 'male'}
                                                                    onChange={handleInputChange}
                                                                    required
                                                                />
                                                                先生
                                                            </label>
                                                            <label>
                                                                <input
                                                                    type="radio"
                                                                    name="recipientGender"
                                                                    value="female"
                                                                    checked={formData.recipientGender === 'female'}
                                                                    onChange={handleInputChange}
                                                                    required
                                                                />
                                                                女士
                                                            </label>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            id="recipientName"
                                                            name="recipientName"
                                                            className="user-input"
                                                            placeholder="姓名"
                                                            value={formData.recipientName}
                                                            onChange={handleInputChange}
                                                            required
                                                        />
                                                    </div>
                                                    <label htmlFor="recipientEmail">電子信箱</label>
                                                    <input
                                                        type="email"
                                                        id="recipientEmail"
                                                        name="recipientEmail"
                                                        className="user-input"
                                                        placeholder="E-mail"
                                                        value={formData.recipientEmail}
                                                        onChange={handleInputChange}
                                                        required
                                                    />
                                                    <label htmlFor="recipientMobile">手機號碼</label>
                                                    <input
                                                        type="tel"
                                                        id="recipientMobile"
                                                        name="recipientMobile"
                                                        className="user-input"
                                                        placeholder="0912345678"
                                                        value={formData.recipientMobile}
                                                        onChange={handleInputChange}
                                                        required
                                                    />
                                                    <label htmlFor="recipientPhone">室內電話</label>
                                                    <input
                                                        type="tel"
                                                        id="recipientPhone"
                                                        name="recipientPhone"
                                                        className="user-input"
                                                        placeholder="0222123456"
                                                        value={formData.recipientPhone}
                                                        onChange={handleInputChange}
                                                    />
                                                    <label className="recipient-address-header">收件地址</label>
                                                    <AddressSelect
                                                        value={formData.recipientAddress}
                                                        onChange={(e) => setFormData({ ...formData, recipientAddress: e.target.value })}
                                                        required
                                                    />
                                                    <div className="address-details">
                                                        <label htmlFor="recipientPostalCode"></label>
                                                        <input
                                                            type="text"
                                                            id="recipientPostalCode"
                                                            name="recipientPostalCode"
                                                            className="postal-code"
                                                            placeholder="郵遞區號"
                                                            value={formData.recipientPostalCode}
                                                            onChange={handleInputChange}
                                                            required
                                                        />
                                                        <label htmlFor="recipientAddressDetail"></label>
                                                        <input
                                                            type="text"
                                                            id="recipientAddressDetail"
                                                            name="recipientAddressDetail"
                                                            className="address-detail"
                                                            placeholder="收件地址"
                                                            value={formData.recipientAddressDetail}
                                                            onChange={handleInputChange}
                                                            required
                                                        />
                                                    </div>
                                                </div>
                                            )}
                                        </fieldset>
                                    </div>

                                    <div className="payment-info">
                                        <fieldset>
                                            <legend className="form-header">配送方式</legend>
                                            <div className="payment-info-row">
                                                <div className="delivery-options">
                                                    <div
                                                        className={`payment-button ${selectedOption === '宅配' ? 'selected' : ''}`}
                                                        onClick={() => handleSelect('宅配')}
                                                    >
                                                        宅配
                                                    </div>
                                                    <div
                                                        className={`payment-button ${selectedOption === '超商取貨' ? 'selected' : ''}`}
                                                        onClick={() => handleSelect('超商取貨')}
                                                    >
                                                        超商取貨
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>

                                        <fieldset>
                                            <legend className="form-header">付款方式</legend>
                                            <div className="payment-info-row">
                                                <div
                                                    className={`payment-button ${paymentOption === '貨到付款' ? 'selected' : ''}`}
                                                    onClick={() => handlePayment('貨到付款')}
                                                >
                                                    貨到付款
                                                </div>
                                                <div
                                                    className={`payment-button ${paymentOption === '信用卡' ? 'selected' : ''}`}
                                                    onClick={() => handlePayment('信用卡')}
                                                >
                                                    信用卡
                                                </div>
                                                <div
                                                    className={`payment-button ${paymentOption === 'ATM付款' ? 'selected' : ''}`}
                                                    onClick={() => handlePayment('ATM付款')}
                                                >
                                                    ATM付款
                                                </div>
                                                <div
                                                    className={`payment-button ${paymentOption === 'LINE PAY' ? 'selected' : ''}`}
                                                    onClick={() => handlePayment('LINE PAY')}
                                                >
                                                    LINE PAY
                                                </div>
                                            </div>
                                        </fieldset>

                                        <fieldset className="invoice-info">
                                            <legend className="form-header">發票索取</legend>
                                            <label htmlFor="invoiceType">請選擇發票類型</label>
                                            <select
                                                name="invoiceType"
                                                id="invoiceType"
                                                className="form-select"
                                                value={invoiceType}
                                                onChange={(e) => setInvoiceType(e.target.value)}
                                            >
                                                <option value="" disabled>請選擇發票類型</option>
                                                <option value="electronic">電子發票</option>
                                                <option value="mobile-barcode">手機條碼</option>
                                                <option value="donation">捐贈發票</option>
                                                <option value="company">公司戶發票(統一發票)</option>
                                            </select>

                                            {invoiceType === 'mobile-barcode' && (
                                                <div className="mobileBarcode-box">
                                                    <label htmlFor="mobileBarcode"></label>
                                                    <input
                                                        type="text"
                                                        id="mobileBarcode"
                                                        name="mobileBarcode"
                                                        className="user-input"
                                                        placeholder="請輸入手機條碼"
                                                        value={mobileBarcode}
                                                        onChange={handleInputChange}
                                                    />
                                                </div>
                                            )}

                                            {invoiceType === 'company' && (
                                                <div className="companyName-box">
                                                    <label htmlFor="companyName">公司抬頭</label>
                                                    <input
                                                        type="text"
                                                        id="companyName"
                                                        name="companyName"
                                                        className="user-input"
                                                        placeholder="小農好忙有限公司"
                                                        value={companyName}
                                                        onChange={handleInputChange}
                                                    />
                                                    <label htmlFor="taxId">統一編號</label>
                                                    <input
                                                        type="text"
                                                        id="taxId"
                                                        name="taxId"
                                                        className="user-input"
                                                        placeholder="11322133"
                                                        value={taxId}
                                                        onChange={handleInputChange}
                                                    />
                                                </div>
                                            )}

                                            <div className="consent-box">
                                                <input
                                                    type="checkbox"
                                                    id="consent"
                                                    name="consent"
                                                    className="consent-checkbox"
                                                    checked={consent}
                                                    onChange={handleConsentChange}
                                                />
                                                <label htmlFor="consent">
                                                    我同意辦理退/換貨時，由本公司代為處理銷售憑證(發票處理/銷售折讓)以加速作業流程
                                                </label>
                                            </div>
                                        </fieldset>
                                    </div>
                                </form>
                            </div>
                        </section>
                        <ButtonGroup
                            preBtnSrc="./cart.html"
                            preBtnClass="continue-shopping"
                            preBtnName="返回上一步"
                            nextBtnSrc="./confirmation.html"
                            nextBtnClass="nextStep"
                            nextbtnName="完成訂購"
                        />
                        <Footer />
                    </main>
                </>
            );
        });
        ReactDOM
            .createRoot(document.getElementById('root'))
            .render(<App />);
    </script>

</body>

</html>