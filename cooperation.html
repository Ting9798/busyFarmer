<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>關於小農-小農好忙</title>
    <link rel="icon" href="./favicon.ico">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel" src="./js/Navbar.js"></script>
    <script type="text/babel" src="./js/useAdjustMargin.js"></script>
    <script type="text/babel" src="./js/Breadcrumbs.js"></script>
    <script type="text/babel" src="./js/Footer.js"></script>
    <script type="text/babel" src="./js/Search.js"></script>
    <script type="text/babel" src="./js/FilterButton.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link rel="stylesheet" href="./css/style.min.css">
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        function CoFarmer(props) {
            return (
                <li>
                    <a href="./planting.html" className="cooperationFamer">
                        <figure><img src={props.coIcon} alt={props.coName} /></figure>
                        <div>{props.coName}</div>
                    </a>
                </li>
            )
        }

        const locations = [
            {
                id: 1,
                coords: [25.18292265221555, 121.54506060827659],
                label: '蘋果',
                farmerName: '北投鍾家農場',
                filter: '北部、蘋果、果乾、市集',
                icon: './images/cooperation/zhong.png'
            },
            {
                id: 2,
                coords: [22.93247821624703, 121.0763758900566],
                label: '柑橘、釋迦、鳳梨',
                farmerName: '張美阿姨橘子園',
                filter: '東部、柑橘、釋迦、鳳梨、果乾、果醬',
                icon: './images/cooperation/orange.png'
            },
            {
                id: 3,
                coords: [23.578269626253224, 119.66066180228646],
                label: '香瓜、西瓜、火龍果',
                farmerName: '香瓜ㄉ鄉',
                filter: '外島、香瓜、西瓜、火龍果、果乾、果醬',
                icon: './images/cooperation/cantaloupe.png'
            },
            {
                id: 4,
                coords: [22.9620670171951, 120.48945769974527],
                label: '芭樂、龍眼、檸檬',
                farmerName: '酥芭樂嘻果園',
                filter: '南部、芭樂、龍眼、檸檬、果乾、果醋',
                icon: './images/cooperation/guava.png'
            },
            {
                id: 5,
                coords: [24.327804743672683, 120.82772896266843],
                label: '葡萄、楊桃、柑桔、水梨',
                farmerName: '萄汁夭夭觀光果園',
                filter: '中部、葡萄、楊桃、柑桔、水梨、果乾、果醋、果醬、果酒、市集',
                icon: './images/cooperation/grape.png'
            },
            {
                id: 6,
                coords: [22.701902886550716, 120.43414587443915],
                label: '荔枝、香蕉、芒果',
                farmerName: '荔爭上游農莊',
                filter: '南部、荔枝、香蕉、芒果、果醬、果酒、觀光',
                icon: './images/cooperation/lichi.png'
            },
            {
                id: 7,
                coords: [24.44412896740089, 121.77164001415775],
                label: '農場待更新',
                farmerName: '農場待更新',
                filter: '農場待更新',
                icon: './images/cooperation/logo.svg'
            }
        ];
        function App(props) {

            const [navProps, setNavProps] = useState({
                headerClassName: 'greenTopbar',
                logoImg: './images/shared/logo-02.svg',
                textColor: 'green'
            });

            useAdjustMargin(navProps.headerClassName);

            const paths = [
                { name: '首頁', href: './index.html' },
                { name: '關於小農', href: './cooperation.html' },
            ];

            const mapRef = useRef(null);
            const [map, setMap] = useState(null);
            const [markers, setMarkers] = useState(null);
            const [filteredFarmers, setFilteredFarmers] = useState(locations); // 新增狀態

            const customIcon = L.icon({
                iconUrl: './images/shared/icon2_sign.svg',
                iconSize: [48, 48],
                iconAnchor: [24, 48],
                popupAnchor: [0, -48]
            });

            useEffect(() => {
                if (mapRef.current && !map) {
                    const mapInstance = L.map(mapRef.current).setView([23.889818108243148, 120.97020831352467], 7);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(mapInstance);

                    const markersLayer = L.layerGroup();
                    locations.forEach(location => {
                        const marker = L.marker(location.coords, { icon: customIcon }).addTo(markersLayer);
                        marker.bindPopup(`
                    <div>
                        <b>${location.farmerName}</b><br>${location.label}
                        <a href="./planting.html">看更多</a>
                    </div>
                `);
                    });

                    markersLayer.addTo(mapInstance);
                    setMap(mapInstance);
                    setMarkers(markersLayer);

                    setTimeout(() => {
                        mapInstance.invalidateSize();
                    }, 0);
                }
            }, [map, mapRef]);

            const handleFilterClick = (id) => {
                if (markers) {
                    markers.clearLayers();

                    const filteredLocations = id === '全部'
                        ? locations
                        : locations.filter(location => location.filter && location.filter.includes(id));

                    filteredLocations.forEach(location => {
                        L.marker(location.coords, { icon: customIcon })
                            .bindPopup
                            (`
                            <div>
                                <b>${location.farmerName}</b><br>${location.label}
                                <a href="./planting.html">看更多</a>
                            </div>
                            `)
                            .addTo(markers);
                    });

                    setFilteredFarmers(filteredLocations); // 更新過濾後的小農資訊
                }
            };

            const showMap = () => {
                document.getElementById('map-display').classList.remove('hidden');
                document.getElementById('farmer-display').classList.add('hidden');
                document.getElementById('map-search-btn').classList.add('active');
                document.getElementById('farmer-search-btn').classList.remove('active');
            };

            const showFarmer = () => {
                document.getElementById('map-display').classList.add('hidden');
                document.getElementById('farmer-display').classList.remove('hidden');
                document.getElementById('map-search-btn').classList.remove('active');
                document.getElementById('farmer-search-btn').classList.add('active');
            };

            useEffect(() => {
                document.getElementById('map-search-btn').addEventListener('click', showMap);
                document.getElementById('farmer-search-btn').addEventListener('click', showFarmer);

                return () => {
                    document.getElementById('map-search-btn').removeEventListener('click', showMap);
                    document.getElementById('farmer-search-btn').removeEventListener('click', showFarmer);
                };
            }, []);

            useEffect(() => {
                showMap();
            }, []);
            return (
                <>
                    {/* 導覽列*/}
                    <Nav
                        headerClassName={navProps.headerClassName}
                        logoImg={navProps.logoImg}
                        textColor={navProps.textColor}
                    />
                    <main>
                        <section id="farmer-search">
                            <header id="title" className="search-center">
                                <Breadcrumbs paths={paths} />
                                {/*搜尋*/}
                                <Search />
                            </header>
                            {/*title*/}
                            <div className="tit-box">
                                {/* 標題 */}
                                <div className="tit-box-text">
                                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M24.5 34.3399C24.26 33.6499 24.13 32.8999 24.13 32.1299C24.13 28.4299 27.13 25.4399 30.82 25.4399C34.51 25.4399 37.51 28.4399 37.51 32.1299C37.51 35.8199 34.51 38.8199 30.82 38.8199C27.9 38.8199 25.41 36.9499 24.5 34.3399Z"
                                            stroke="currentColor" strokeWidth="2" strokeMiterlimit="10" />
                                        <path
                                            d="M7.46997 29V23.07C7.46997 21.93 8.39997 21 9.53997 21C10.34 21 11.07 20.54 11.41 19.81L15.41 11.31C15.75 10.58 16.48 10.12 17.28 10.12H28.16C28.53 10.12 28.87 10.29 29.09 10.59L34.16 20.56C34.31 20.86 34.62 21.05 34.96 21.05H36.95"
                                            stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                                        <path
                                            d="M19.39 14.83H25.97C26.21 14.83 26.44 14.96 26.57 15.16L29.5 19.85C29.8 20.32 29.46 20.94 28.9 20.94H17.56C17.06 20.94 16.72 20.44 16.9 19.97L18.73 15.28C18.84 15.01 19.1 14.83 19.39 14.83Z"
                                            fill="currentColor" />
                                        <path
                                            d="M30.8199 33.13C31.3722 33.13 31.8199 32.6823 31.8199 32.13C31.8199 31.5777 31.3722 31.13 30.8199 31.13C30.2677 31.13 29.8199 31.5777 29.8199 32.13C29.8199 32.6823 30.2677 33.13 30.8199 33.13Z"
                                            fill="currentColor" />
                                        <path
                                            d="M6.09002 34.96C5.88002 34.37 5.77002 33.74 5.77002 33.08C5.77002 29.94 8.32002 27.39 11.46 27.39C14.6 27.39 17.15 29.94 17.15 33.08C17.15 36.22 14.6 38.77 11.46 38.77C8.98002 38.77 6.87002 37.18 6.09002 34.96Z"
                                            stroke="currentColor" strokeWidth="2" strokeMiterlimit="10" />
                                        <path
                                            d="M11.46 34.08C12.0122 34.08 12.46 33.6322 12.46 33.08C12.46 32.5277 12.0122 32.08 11.46 32.08C10.9077 32.08 10.46 32.5277 10.46 33.08C10.46 33.6322 10.9077 34.08 11.46 34.08Z"
                                            fill="currentColor" />
                                        <path
                                            d="M43.09 32.26C40.01 30.71 37.85 27.07 37.85 22.82C37.85 18.57 40.01 14.94 43.09 13.39"
                                            stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                                        <path
                                            d="M43.35 30.31C41.28 29.08 39.83 26.19 39.83 22.83C39.83 19.47 41.28 16.58 43.35 15.35"
                                            stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" />
                                        <path d="M19.51 33.08H21.76" stroke="currentColor" strokeWidth="2" strokeLinecap="round"
                                            strokeLinejoin="round" />
                                    </svg>

                                    <h3>尋找小農</h3>
                                </div>
                                {/*按鈕*/}
                                <a href="./joinUs.html" className="tit-btn">
                                    <div className="tit-btn-box">
                                        <h3>加入我們</h3>

                                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" className="tit-btn-icon">
                                            <path
                                                d="M26.25 7.94995C26.25 7.12152 25.5784 6.44995 24.75 6.44995C23.9216 6.44995 23.25 7.12152 23.25 7.94995V39.95C23.25 40.7784 23.9216 41.45 24.75 41.45C25.5784 41.45 26.25 40.7784 26.25 39.95V7.94995Z"
                                                fill="currentColor" />
                                            <path
                                                d="M40.75 25.45C41.5784 25.45 42.25 24.7784 42.25 23.95C42.25 23.1215 41.5784 22.45 40.75 22.45L8.75 22.45C7.92157 22.45 7.25 23.1215 7.25 23.95C7.25 24.7784 7.92157 25.45 8.75 25.45L40.75 25.45Z"
                                                fill="currentColor" />
                                        </svg>
                                    </div>
                                </a>
                            </div>

                            {/*內容區*/}
                            <div className="farmer-search-container">
                                <div className="farmer-search-buttons">
                                    <div className="farmer-search-buttons-category">
                                        <div id="map-search-btn" className="search-options">依地圖搜尋</div>
                                        <div id="farmer-search-btn" className="search-options">依小農搜尋</div>
                                    </div>
                                    <FilterButton onFilterClick={handleFilterClick} />
                                </div>
                                {/* 顯示畫面 */}
                                <div className="farmer-search-display">
                                    <div className="map-display-bg">
                                        <div id="map-display" className="map-display hidden" ref={mapRef}></div>
                                        <div id="farmer-display" className="farmer-display hidden">
                                            <ul className="cooperationFamer-box">
                                                {filteredFarmers.map(location => (
                                                    <CoFarmer
                                                        key={location.id}
                                                        coName={location.farmerName}
                                                        coIcon={location.icon}
                                                    />
                                                ))}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <Footer />
                    </main >
                </>
            )
        }
        ReactDOM
            .createRoot(document.getElementById('root'))
            .render(<App />);
    </script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</body>

</html>